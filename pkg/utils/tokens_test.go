package utils

import (
	"github.com/stretchr/testify/require"
	"testing"
)

func TestComputeTokens(t *testing.T) {
	required := require.New(t)

	// All the expected data was generated with the original DSE script

	required.Equal(
		[][]string{{
			"-9223372036854775808",
			"-3074457345618258603",
			"3074457345618258602",
		}},
		ComputeTokens([]int{3}, Murmur3Partitioner),
	)

	required.Equal(
		[][]string{{
			"0",
			"56713727820156410577229101238628035242",
			"113427455640312821154458202477256070484",
		}},
		ComputeTokens([]int{3}, RandomPartitioner),
	)

	required.Equal(
		[][]string{{
			"-9223372036854775808",
			"-4611686018427387904",
			"0",
			"4611686018427387904",
		}},
		ComputeTokens([]int{4}, Murmur3Partitioner),
	)

	required.Equal(
		[][]string{{
			"0",
			"42535295865117307932921825928971026432",
			"85070591730234615865843651857942052864",
			"127605887595351923798765477786913079296",
		}},
		ComputeTokens([]int{4}, RandomPartitioner),
	)

	required.Equal(
		[][]string{{
			"-9223372036854775808",
			"-3074457345618258603",
			"3074457345618258602",
		}, {
			"-3152954128910639674",
			"2995960562325877531",
			"9144875253562394737",
		}},
		ComputeTokens([]int{3, 3}, Murmur3Partitioner),
	)

	required.Equal(
		[][]string{{
			"0",
			"56713727820156410577229101238628035242",
			"113427455640312821154458202477256070484",
		}, {
			"55989722784154413846455963776007251813",
			"112703450604310824423685065014635287055",
			"169417178424467235000914166253263322299",
		}},
		ComputeTokens([]int{3, 3}, RandomPartitioner),
	)

	required.Equal(
		[][]string{{
			"-9223372036854775808",
			"-4611686018427387904",
			"0",
			"4611686018427387904",
		}, {
			"-4690182801719768975",
			"-78496783292381071",
			"4533189235135006833",
			"9144875253562394737",
		}},
		ComputeTokens([]int{4, 4}, Murmur3Partitioner),
	)

	required.Equal(
		[][]string{{
			"0",
			"42535295865117307932921825928971026432",
			"85070591730234615865843651857942052864",
			"127605887595351923798765477786913079296",
		}, {
			"41811290829115311202148688466350243003",
			"84346586694232619135070514395321269435",
			"126881882559349927067992340324292295867",
			"169417178424467235000914166253263322299",
		}},
		ComputeTokens([]int{4, 4}, RandomPartitioner),
	)

	required.Equal(
		[][]string{{
			"-9223372036854775808",
			"-4611686018427387904",
			"0",
			"4611686018427387904",
		}, {
			"-3152954128910639674",
			"2995960562325877531",
			"9144875253562394737",
		}, {
			"-5691016788697627627",
			"-2001667973955717304",
			"1687680840786193019",
			"5377029655528103342",
			"9066378470270013666",
		}},
		ComputeTokens([]int{4, 3, 5}, Murmur3Partitioner),
	)

	required.Equal(
		[][]string{{
			"0",
			"42535295865117307932921825928971026432",
			"85070591730234615865843651857942052864",
			"127605887595351923798765477786913079296",
		}, {
			"55989722784154413846455963776007251813",
			"112703450604310824423685065014635287055",
			"169417178424467235000914166253263322299",
		}, {
			"32580226620089852884791185817935254287",
			"66608463312183699231128646561112075432",
			"100636700004277545577466107304288896577",
			"134664936696371391923803568047465717722",
			"168693173388465238270141028790642538870",
		}},
		ComputeTokens([]int{4, 3, 5}, RandomPartitioner),
	)
}
